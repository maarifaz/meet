<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Parent Meeting – Teacher Directory</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;800&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />
    <style>
      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        font-family: "Montserrat", sans-serif;
        background: linear-gradient(135deg, #0e1a2b, #1c273b);
        color: #fff;
        min-height: 100vh;
        display: flex;
        transition: background 0.5s;
      }

      #sidebar {
        width: 28%;
        background: linear-gradient(180deg, #0b1523, #14203a);
        border-radius: 20px;
        padding: 30px;
        overflow-y: auto;
        transition: all 0.3s;
      }

      #content {
        flex: 1;
        display: flex;
        justify-content: center;
        align-items: flex-start;
        padding-top: 40px;
        position: relative;
        transition: all 0.3s;
      }

      h1 {
        font-size: 32px;
        margin-bottom: 20px;
      }
      .filter-container {
        margin-bottom: 20px;
        display: flex;
        flex-direction: column;
        gap: 10px;
      }
      select {
        padding: 8px 12px;
        border-radius: 10px;
        border: none;
        font-size: 16px;
        background: #1c273b;
        color: #fff;
      }

      .teacher-card {
        display: flex;
        align-items: center;
        gap: 16px;
        padding: 16px;
        border-radius: 16px;
        cursor: pointer;
        transition: all 0.3s ease;
        background: rgba(255, 255, 255, 0.08);
        margin-bottom: 12px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        position: relative;
      }
      .teacher-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 12px 20px rgba(0, 0, 0, 0.5);
      }
      .teacher-card.active {
        box-shadow: 0 0 25px 4px #4ade80;
        transform: scale(1.05);
      }
      .teacher-card.offline {
        opacity: 0.5;
        color: #f87171;
      }

      .avatar {
        width: 64px;
        height: 64px;
        border-radius: 50%;
        background: #1e2f4f;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 800;
        font-size: 22px;
        overflow: hidden;
        transition: all 0.3s;
      }

      .teacher-name {
        font-size: 18px;
        font-weight: 600;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      #info-card {
        position: sticky;
        top: 80px;
        width: 80%;
        padding: 80px;
        border-radius: 64px;
        background: linear-gradient(135deg, #1e3c72, #2a5298, #1e3c72);
        background-size: 600% 600%;
        animation: gradMove 15s ease infinite;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        text-align: left;
        opacity: 0;
        transform: translateY(20px);
        transition: all 0.5s;
        font-size: 25px;
        color: #fff;
      }
      #info-card.show {
        opacity: 1;
        transform: translateY(0);
      }
      #info-title {
        font-size: 60px;
        font-weight: 800;
        margin-bottom: 25px;
        color: #fff;
        text-align: center;
      }

      .line {
        display: flex;
        align-items: flex-start;
        gap: 10px;
        margin: 12px 0;
      }
      .line i {
        font-size: 20px;
        color: #ffd700;
        margin-top: 3px;
      }
      .label {
        opacity: 0.7;
        width: 140px;
      }
      .value {
        font-weight: 600;
        display: flex;
        flex-direction: column;
        gap: 2px;
        color: #f0f0f0;
        line-height: 1.5;
      }

      #clock {
        position: absolute;
        top: 30px;
        right: 40px;
        font-size: 22px;
        color: #ffd700;
        text-shadow: 0 0 10px #ffd700;
      }
      #logo {
        position: absolute;
        top: 25px;
        left: 40px;
        font-size: 22px;
        font-weight: 800;
      }

      @keyframes gradMove {
        0% {
          background-position: 0% 50%;
        }
        50% {
          background-position: 100% 50%;
        }
        100% {
          background-position: 0% 50%;
        }
      }

      /* Info Button + Modal */
      #info-btn {
        position: fixed;
        bottom: 30px;
        right: 30px;
        background: #ffd700;
        color: #000;
        padding: 12px 20px;
        border-radius: 12px;
        cursor: pointer;
        font-weight: 600;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        z-index: 9999;
      }

      #info-modal {
        display: none;
        position: fixed;
        z-index: 10000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0, 0, 0, 0.6);
      }

      #info-content {
        background-color: #fff;
        margin: 10% auto;
        padding: 30px;
        border-radius: 20px;
        width: 80%;
        max-width: 500px;
        color: #000;
        position: relative;
        text-align: left;
      }

      #close-info {
        position: absolute;
        top: 15px;
        right: 20px;
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
      }

      #info-content button {
        margin-right: 5px;
        padding: 5px 10px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        background: #1c273b;
        color: #fff;
      }

      #info-content h2 {
        margin-bottom: 15px;
        text-align: center;
      }

      /* Mobile responsive */
      @media (max-width: 600px) {
        body {
          flex-direction: column;
        }
        #sidebar {
          width: 100%;
          padding: 15px;
          margin-bottom: 15px;
          max-height: 50vh;
          overflow-y: auto;
        }
        #content {
          width: 100%;
          padding: 15px;
          max-height: 50vh;
          overflow-y: auto;
        }
        #info-card {
          width: 95%;
          padding: 15px;
          font-size: 16px;
        }
        .teacher-card {
          flex-direction: row;
          gap: 12px;
          padding: 12px;
        }
        #info-btn {
          padding: 12px 20px;
          font-size: 16px;
        }
        #info-content {
          width: 90%;
          margin: 20% auto;
        }
        select {
          font-size: 18px;
          padding: 10px 14px;
        }
      }
    </style>
  </head>
  <body>
    <div id="sidebar">
      <h1>Teachers</h1>
      <div class="filter-container">
        <select id="classFilter">
          <option value="all">All Classes</option>
        </select>
        <select id="subjectFilter">
          <option value="all">All Subjects</option>
        </select>
      </div>
      <div id="teacherList"></div>
    </div>

    <div id="content">
      <div id="info-card">
        <div id="info-title">Select a Teacher</div>
        <div class="line">
          <i class="fas fa-door-open"></i><span class="label">Room:</span
          ><span id="room" class="value">—</span>
        </div>
        <div class="line">
          <i class="fas fa-layer-group"></i><span class="label">Floor:</span
          ><span id="floor" class="value">—</span>
        </div>
        <div class="line">
          <i class="fas fa-user-friends"></i
          ><span class="label">Assistant:</span
          ><span id="assistant" class="value">—</span>
        </div>
        <div class="line">
          <i class="fas fa-clock"></i><span class="label">Schedule:</span
          ><span id="schedule" class="value">—</span>
        </div>
        <div class="line">
          <i class="fas fa-book"></i><span class="label">Subjects:</span
          ><span id="subjects" class="value">—</span>
        </div>
        <div class="line">
          <i class="fas fa-school"></i><span class="label">Classes:</span
          ><span id="classes" class="value">—</span>
        </div>
      </div>
    </div>

    <!-- Info Button -->
    <div id="info-btn">Info</div>

    <!-- Info Modal -->
    <div id="info-modal">
      <div id="info-content">
        <span id="close-info">&times;</span>
        <h2>Haqqında / About / О программе</h2>
        <div class="lang-content" id="lang-az">
          Bu proqram valideynlər üçün hazırlanmışdır. Valideynlər müəllimlərin
          hazırda məktəbdə olub-olmamasını, dərs dediyi sinifləri və otaq
          məlumatlarını görə bilər, görüşlərini daha rahat təşkil edə bilər.
        </div>
        <div class="lang-content" id="lang-en" style="display: none">
          This program is designed for parents. Parents can see whether teachers
          are currently at school, which classes they teach, and their room
          information, making it easier to schedule meetings.
        </div>
        <div class="lang-content" id="lang-ru" style="display: none">
          Эта программа предназначена для родителей. Родители могут видеть,
          находится ли учитель в школе, какие классы он ведет и в какой комнате,
          что облегчает организацию встреч.
        </div>
        <div style="margin-top: 15px">
          <button onclick="showLang('az')">AZ</button>
          <button onclick="showLang('en')">EN</button>
          <button onclick="showLang('ru')">RU</button>
        </div>
      </div>
    </div>

    <script>
      let data = [],
        filteredData = [];
      const listEl = document.getElementById("teacherList");
      const infoCard = document.getElementById("info-card");
      const classFilter = document.getElementById("classFilter");
      const subjectFilter = document.getElementById("subjectFilter");
      const assistantsMap = {
        Giriş: "Nigar Seferli",
        1: "Aytən Əmirahova",
        2: "Səma Dostizadə Əfqan",
        3: "Aysel Priyeva",
        4: "Nurcan Kərimova",
      };

      function now() {
        const d = new Date();
        return d.getHours() * 60 + d.getMinutes();
      }
      function toMin(t) {
        const [a, b] = t.split(":");
        return +a * 60 + +b;
      }

      fetch("teachers.json")
        .then((r) => r.json())
        .then((j) => {
          data = j;
          populateFilters();
          renderList();
        });

      function populateFilters() {
        const classes = new Set(),
          subjects = new Set();
        data.forEach((t) => {
          if (Array.isArray(t.subjects))
            t.subjects.forEach((s) => subjects.add(s));
          if (Array.isArray(t.classes))
            t.classes.forEach((c) => classes.add(c));
        });
        [...classes].sort().forEach((c) => {
          const opt = document.createElement("option");
          opt.value = c;
          opt.textContent = c;
          classFilter.appendChild(opt);
        });
        [...subjects].sort().forEach((s) => {
          const opt = document.createElement("option");
          opt.value = s;
          opt.textContent = s;
          subjectFilter.appendChild(opt);
        });
      }

      function applyFilters() {
        const c = classFilter.value,
          s = subjectFilter.value;
        filteredData = data.filter((t) => {
          let classMatch =
            c === "all" ? true : t.classes && t.classes.includes(c);
          let subjectMatch =
            s === "all" ? true : t.subjects && t.subjects.includes(s);
          return classMatch && subjectMatch;
        });
        renderList(filteredData);
      }

      function renderList(list = filteredData.length ? filteredData : data) {
        listEl.innerHTML = "";
        const nowMinutes = now();
        const maleNames = ["Həmid", "Muhammed", "Məmməd", "Sərxan", "Vidadi"];
        list
          .sort((a, b) => a.teacher.localeCompare(b.teacher, "az"))
          .forEach((t) => {
            const isMale = maleNames.some((n) =>
              t.teacher.toLowerCase().includes(n.toLowerCase())
            );
            const initials = t.teacher
              .split(" ")
              .slice(0, 2)
              .map((w) => w[0])
              .join("")
              .toUpperCase();
            const fromMin = toMin(t.from),
              toMinTime = toMin(t.to);
            const isActive = nowMinutes >= fromMin && nowMinutes <= toMinTime;
            const avatarSVG = `<svg viewBox="0 0 100 100" width="64" height="64"><defs><linearGradient id="g${initials}" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="${
              isMale ? "#2563eb" : "#c026d3"
            }"/><stop offset="100%" stop-color="${
              isMale ? "#1e40af" : "#86198f"
            }"/></linearGradient></defs><circle cx="50" cy="50" r="50" fill="url(#g${initials})"/><text x="50%" y="55%" text-anchor="middle" fill="#fff" font-size="36" font-family="Segoe UI, Arial" font-weight="600" dominant-baseline="middle">${initials}</text><circle cx="80" cy="80" r="10" fill="${
              isActive ? "#4ade80" : "#f87171"
            }" stroke="#fff" stroke-width="2"/></svg>`;
            const div = document.createElement("div");
            div.className = "teacher-card";
            if (!isActive) div.classList.add("offline");
            div.innerHTML = `<div class="avatar">${avatarSVG}</div><div class="teacher-name">${t.teacher}</div>`;
            div.onclick = () => selectTeacher(t, div, isActive);
            listEl.appendChild(div);
          });
      }

      let meetingTimer;
      function selectTeacher(t, el, isActive) {
        document
          .querySelectorAll(".teacher-card")
          .forEach((c) => c.classList.remove("active"));
        el.classList.add("active");

        document.getElementById("info-title").textContent = t.teacher;
        document.getElementById("room").textContent = isActive ? t.room : "—";
        document.getElementById("floor").textContent = isActive
          ? "Floor " + t.floor
          : "—";
        document.getElementById("assistant").textContent = isActive
          ? assistantsMap[t.floor] || "—"
          : "—";
        document.getElementById("schedule").textContent = t.from + " - " + t.to;
        document.getElementById("subjects").textContent = Array.isArray(
          t.subjects
        )
          ? t.subjects.join("\n")
          : "—";
        document.getElementById("classes").textContent = Array.isArray(
          t.classes
        )
          ? t.classes.join("\n")
          : "—";

        infoCard.classList.add("show");

        if (!isActive) {
          document.getElementById("info-title").textContent =
            t.teacher + " (Offline)";
          alert(
            "Teacher is currently not at school. You can schedule a meeting on workdays or contact via Teams."
          );
          return;
        }

        if (meetingTimer) clearTimeout(meetingTimer);

        meetingTimer = setTimeout(() => {
          el.classList.remove("active");
          el.classList.add("offline");
          document.getElementById("info-title").textContent =
            t.teacher + " (Offline)";
          document.getElementById("room").textContent = "—";
          document.getElementById("floor").textContent = "—";
          document.getElementById("assistant").textContent = "—";
        }, 300000);
      }

      classFilter.addEventListener("change", applyFilters);
      subjectFilter.addEventListener("change", applyFilters);

      setInterval(() => {
        document.getElementById("clock").textContent =
          new Date().toLocaleTimeString();
      }, 1000);

      // Info modal
      const infoBtn = document.getElementById("info-btn");
      const infoModal = document.getElementById("info-modal");
      const closeInfo = document.getElementById("close-info");
      infoBtn.onclick = () => (infoModal.style.display = "block");
      closeInfo.onclick = () => (infoModal.style.display = "none");
      window.onclick = (e) => {
        if (e.target == infoModal) infoModal.style.display = "none";
      };

      function showLang(lang) {
        document
          .querySelectorAll(".lang-content")
          .forEach((el) => (el.style.display = "none"));
        document.getElementById("lang-" + lang).style.display = "block";
      }
    </script>
  </body>
</html>
